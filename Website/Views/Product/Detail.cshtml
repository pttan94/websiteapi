@model int
@{
    ViewBag.Title = "Product Detail";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <div class="women_main">
        <!-- start content -->
        <div class="row single">
            <div class="col-md-12 det">
                <div class="single_left" ng-controller="ProductDetailController">
                    <div class="grid images_3_of_2">
                        <img src="{{product.Image}}" alt="" class="img-responsive" />
                    </div>
                    <div class="desc1 span_3_of_2">
                        <h3>{{product.Name}}</h3>
                        <br>

                        <p>{{product.MetaDescription}}</p>
                        <div class="price">
                            <span class="text">Price:</span>
                            <span class="price-new">
                                ${{product.Price}}
                            </span><span class="price-old">${{product.PriceOld}}</span>
                        </div>

                        <div class="btn_form">
                            <a href="javascript:void(0)" ng-click="addToCart(product.ProductID)">Add to cart</a>
                        </div>


                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="single-bottom1" ng-controller="ProductDetailController">
                    <h6>Details</h6>
                    <p class="prod-desc">{{product.Description}}</p>
                </div>
                <div class="single-bottom2" ng-controller="RelatedProductController">
                    <h6>Related Products</h6>

                    <div class="product" ng-repeat="p in productRelated">
                        <div class="product-desc">
                            <div class="product-img">
                                <img src="{{p.Image}}" alt="" class="img-responsive" />
                            </div>
                            <div class="prod1-desc">
                                <h5><a class="product_link" href="~/ProductDetail/Detail?ProductID={{p.ProductID}}">{{p.Name}}</a></h5>
                                <p class="product_descr">{{p.MetaDescription}}</p>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="product_price">
                            <span class="price-access">${{p.Price}}</span>
                            <button class="button1" ng-click="addToCart(p.ProductID)"><span>Add to cart</span></button>
                        </div>
                        <div class="clearfix"></div>
                    </div>

                </div>
            </div>
            <div class="col-md-3 hidden">
                <div class="w_sidebar">
                    <div class="w_nav1">
                        <h4>All</h4>
                        <ul>
                            <li><a href="women.html">women</a></li>
                            <li><a href="#">new arrivals</a></li>
                            <li><a href="#">trends</a></li>
                            <li><a href="#">boys</a></li>
                            <li><a href="#">girls</a></li>
                            <li><a href="#">sale</a></li>
                        </ul>
                    </div>
                    <h3>filter by</h3>
                    <section class="sky-form">
                        <h4>categories</h4>
                        <div class="row1 scroll-pane">
                            <div class="col col-4">
                                <label class="checkbox"><input type="checkbox" name="checkbox" checked=""><i></i>kurtas</label>
                            </div>
                            <div class="col col-4">
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>kutis</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>churidar kurta</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>salwar</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>printed sari</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>shree</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>Anouk</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>biba</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>fashion sari</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>fashion sari</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>fashion sari</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>fashion sari</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>fashion sari</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>fashion sari</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>fashion sari</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>fashion sari</label>
                            </div>
                        </div>
                    </section>
                    <section class="sky-form">
                        <h4>brand</h4>
                        <div class="row1 scroll-pane">
                            <div class="col col-4">
                                <label class="checkbox"><input type="checkbox" name="checkbox" checked=""><i></i>shree</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>Anouk</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>biba</label>
                            </div>
                            <div class="col col-4">
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>vishud</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>amari</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>shree</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>Anouk</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>biba</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>shree</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>Anouk</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>biba</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>shree</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>Anouk</label>
                                <label class="checkbox"><input type="checkbox" name="checkbox"><i></i>biba</label>
                            </div>
                        </div>
                    </section>
                    <section class="sky-form">
                        <h4>colour</h4>
                        <ul class="w_nav2">
                            <li><a class="color1" href="#"></a></li>
                            <li><a class="color2" href="#"></a></li>
                            <li><a class="color3" href="#"></a></li>
                            <li><a class="color4" href="#"></a></li>
                            <li><a class="color5" href="#"></a></li>
                            <li><a class="color6" href="#"></a></li>
                            <li><a class="color7" href="#"></a></li>
                            <li><a class="color8" href="#"></a></li>
                            <li><a class="color9" href="#"></a></li>
                            <li><a class="color10" href="#"></a></li>
                            <li><a class="color12" href="#"></a></li>
                            <li><a class="color13" href="#"></a></li>
                            <li><a class="color14" href="#"></a></li>
                            <li><a class="color15" href="#"></a></li>
                            <li><a class="color5" href="#"></a></li>
                            <li><a class="color6" href="#"></a></li>
                            <li><a class="color7" href="#"></a></li>
                            <li><a class="color8" href="#"></a></li>
                            <li><a class="color9" href="#"></a></li>
                            <li><a class="color10" href="#"></a></li>
                        </ul>
                    </section>
                    <section class="sky-form">
                        <h4>discount</h4>
                        <div class="row1 scroll-pane">
                            <div class="col col-4">
                                <label class="radio"><input type="radio" name="radio" checked=""><i></i>60 % and above</label>
                                <label class="radio"><input type="radio" name="radio"><i></i>50 % and above</label>
                                <label class="radio"><input type="radio" name="radio"><i></i>40 % and above</label>
                            </div>
                            <div class="col col-4">
                                <label class="radio"><input type="radio" name="radio"><i></i>30 % and above</label>
                                <label class="radio"><input type="radio" name="radio"><i></i>20 % and above</label>
                                <label class="radio"><input type="radio" name="radio"><i></i>10 % and above</label>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>
        <!-- end content -->
    </div>
</div>

<script type="text/javascript">

    app.controller('ProductDetailController', function ($scope, $http, $window) {
        var ID = @Model;
        $http.get(baseAPIUrl+"api/Product?ProductID=" + ID)
        .success(function (response) {
            $scope.product = response;
            document.title =$scope.product.Name;
        })
        .error(function (error) { alert(error); });
        $scope.addToCart = function (ID) {
            $scope.isHaveItem = 0;
            $scope.Quantity = 1;
            console.log($window.sessionStorage.length);

            if ($window.sessionStorage.length > 0) {
                for ( var i = 0, len = sessionStorage.length; i < len; i++ )
                {
                    var temp = $window.sessionStorage.getItem(sessionStorage.key(i));
                    var item = JSON.parse(temp);
                    if (item.ProductID == ID) {
                        $scope.isHaveItem = 1;
                        break;
                    }
                }
            }
            
            if ($scope.isHaveItem == 0)
            {
                json = {
                    ProductID: ID,
                    Name: $scope.product.Name,
                    Image: $scope.product.Image,
                    Price: $scope.product.Price,
                    Quantity:  $scope.Quantity
                }
                console.log(json);
                $window.sessionStorage.setItem(ID, JSON.stringify(json));    
                console.log($window.sessionStorage);
                window.alert("Add to Cart success!");
            }
            else
            {
                window.alert("This product is already in cart! Please try with another product!");
            }
        };
    }).controller('RelatedProductController', function ($scope, $http) {
        var ID = @Model;
        $http.get(baseAPIUrl+"api/Product?ProductRelatedID=" + ID)
        .success(function (response) {
            $scope.productRelated = response;
        })
        .error(function (error) { alert(error); });
    });

</script>
